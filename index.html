<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    /* 滚动条滑块 */
    .select-app-group ::-webkit-scrollbar{
        width: 5px;
    }
    .select-app-group ::-webkit-scrollbar-track {
        border-radius: 10px;
    }
    .select-app-group ::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background: rgba(0,0,0,0.3);
    }
    
    /* other */
    .select-app-group {
        width: 656px;
        border: 1px solid #afafaf;
    }
    .select-app-group ::-webkit-scrollbar-thumb:window-inactive {
        background: #afafaf;
    }
    
    .select-app-group .title {
        text-align: center;
        border-bottom: 1px solid #afafaf;
        margin: 0;
        padding: 6px;
    }
    .select-app-group .select-wrap {
        display: flex;
        position: relative;
    }
    .select-app-group .search-warp {
        position: absolute;
        width: calc(50% - 7px);
        margin: 0;
        padding: 8px 0px 0px;
        background: white;
        z-index: 1;
    }
    .select-app-group .left-box {
        width: 50%;
        height: 400px;
        padding: 5px 0;
        box-sizing: border-box;
        border-right: 1px solid #afafaf;
        overflow: auto;
    }
    .select-app-group .input-wrap {
        position: relative;
        display: block;
        width: 90%;
        margin: auto;
    }
    .select-app-group .input-wrap::after {
        content: "";
        position: absolute;
        left: 5px;
        top: 4px;
        width: 16px;
        height: 16px;
        background: url(./img/search.png);
        background-size: contain;
        z-index: 1;
    }
    .select-app-group .search-input {
        padding-left: 22px;
        width: 100%;
        height: 26px;
        margin: 0 0 10px;
        box-sizing: border-box;
    }
    .select-wrap .left-box {
        padding-top: 50px;
    }

    /* tree module */
    .tree-wrap ul{
        margin: 0;
        padding: 0;
    }
    .tree-wrap ul li {
        list-style: none;
        padding-left: 10px;
        line-height: 30px;
        user-select: none;
    }
    .tree-wrap .list-item-wrap .item {
        position: relative;
    }
    .tree-wrap .list-item-wrap.group-item > .item::before, 
    .tree-wrap .list-item-wrap.root-item > .item::before {
        content: "";
        position: absolute;
        top: 12px;
        left: 9px;
        display: block;
        border-width:4px 4px; 
        border-style:solid; 
        border-color:rgba(255, 255, 255, 0) rgba(255, 255, 255, 0) rgba(255, 255, 255, 0) #4c4c4c;
    }
    .tree-wrap .list-item-wrap.group-item > .item.open::before, 
    .tree-wrap .list-item-wrap.root-item > .item.open::before {
        transform-origin: 25% 50%;
        transform: rotate(90deg);
    }
    .tree-wrap .list-item-wrap.group-item > ul,
    .tree-wrap .list-item-wrap.root-item > ul {
        display: none;
    }
    .tree-wrap .list-item-wrap.group-item.open > ul ,
    .tree-wrap .list-item-wrap.root-item.open > ul {
        display: block;
    }
    .tree-wrap .list-item-wrap .item {
        display: inline-block;
        width: 100%;
        padding: 0 8px 0 18px;
        box-sizing: border-box;
    }
    .tree-wrap .list-item-wrap .item:hover {
        background-color: #00000014;
    }
    .tree-wrap li .icon {
        display: inline-block;
        width: 18px;
        height: 18px;
        margin-right: 5px;
        vertical-align: sub;
        background-repeat: no-repeat;
    }
    .tree-wrap li .icon-all {
        background-image: url(./img/all.png);
        background-size: contain;
    }
    .tree-wrap li .icon-group {
        background-image: url(./img/group.png);
        background-size: contain;
    }
    .tree-wrap .checkbox {
        position: relative;
        float: right;
        height: 21px;
        margin-top: 4px;
    }
    .tree-wrap .checkbox i {
        display: inline-block;
        width: 20px;
        height: 20px;
        background: url(./img/noselect.png) no-repeat;
        background-size: contain;
        cursor: pointer;
    }
    .tree-wrap .checkbox input[type="checkbox"]:checked+i {
        display: inline-block;
        width: 20px;
        height: 20px;
        background: url(./img/select.png) no-repeat;
        background-size: contain;
    }
    .tree-wrap .checkbox input[type="checkbox"]{
        display: none;
    }
</style>
<body>
    <!-- <input type="button" value="点我弹出框" class="dialog_btn1b ml30">
    <br>
    <br> -->

    <div title="设置属性" id="addNewBox" class="select-app-group" >
        <p class="title">选择应用组</p>
        <div class="select-wrap">
            <div class="search-warp">
                <sapn class="input-wrap">
                    <input type="text" class="search-input" placeholder="搜索">
                </sapn>
            </div>

            <div class="left-box">    
            </div>
            <div class="right-box"></div>
        </div>
    </div>

    <div id="demo" style="width: 300px;"></div>

</body>

<script>

var data = [{
    name: "体验测试",
    id: 1,
    childrens:[{
            name: "应用组1",
            id: 1
        },{
            name: "应用组2",
            id: 2
        },{
            name: "应用组3",
            id: 3
        }]
    },{
        name: "无线运营",
        id: 2,
        childrens:[{
            name: "应用组1",
            id: 4,
        },{
            name: "应用组2",
            id: 5
        }]
    },{
        name: "无线运营2",
        id: 3,
        childrens:[{
            name: "应用组1",
            id: 6
        },{
            name: "应用组2",
            id: 7
        },{
            name: "应用组3",
            id: 8
        },{
            name: "应用组4",
            id: 9
        },
        {
            name: "应用组5",
            id: 10
        },{
            name: "应用组6",
            id: 11
        }]
    }]

function extend(subClass, superClass) {
    var F = function() {}
    F.prototype = superClass.prototype;
    subClass.prototype = new F();
    subClass.prototype.constructor = subClass;
    subClass.superclass = superClass.prototype
    if(superClass.prototype.contructor == Object.prototype.constructor) {
        superClass.prototype.constructor = superClass;
    }
}

/* 树类 */
function STree(wrapElm, data, option={}) {
    this.element = document.createElement('ul');
    this.element.className = "group-item-wrap";
    this.rootElement = new STreeRoorNode("选择全部", null, option)
    this.data = data;
    this.childrenList = [];
    wrapElm.className += " tree-wrap"
    wrapElm.appendChild(this.element);
    this.addRootElement(this.rootElement);
    this.setData(data, option);
}
STree.prototype.addRootElement = function(child){
    this.childrenList.push(child)
    this.element.appendChild(child.element);
};
STree.prototype.addNode =  function(child){
    this.rootElement.childrenList.push(child)
    this.rootElement.childElement.appendChild(child.element);
};
STree.prototype.setData = function(data, option) {
    var that = this
    data.forEach(function(data) {
        if(data.childrens) {
            var node = new STreeGroupNode(data.name, data.id, option);
            that.addNode(node);
            data.childrens.forEach(function(data) {
                node.setData(data, option);
            })
        }else {
            var node = new STreeItemNode(data.name, data.id, option);
            that.addNode(node);
        }
    })
    
    
}

/* 树的 node 接口类 */
var STreeNode = function (name, id, type, option) {
    this.name = name;
    this.id = id;
    this.type = type;  // 'group | item'
    this.element = null;
    this.checkBoxEle = null;
    this.isSelect = false;
    this.childrenList = [];

    this.onSelectChange =  Object.prototype.toString.call(option.onSelectChange) === "[object Function]" ? option.onSelectChange : function(){};
}
STreeNode.prototype.addNode = function(child){
    this.childrenList.push(child)
    this.childElement.appendChild(child.element);
};
STreeNode.prototype.removeNode = function(child){
    for(var i=0; i<this.childrenList.length ;i++) {
        if(this.childrenList(i) == child) {
            this.childrenList.splice(i, 1);
            child.removeNode()
            break;
        }
    }
};
STreeNode.prototype.show = function(){
    if(this.element.className.indexOf('open') == -1) {
        this.element.className = this.element.className.trim() + " open";
    }
};
STreeNode.prototype.hide = function(){
    if(this.element.className.indexOf('open') !== -1) {
        this.element.className = this.element.className.split("open").join(" ").trim()
    }
};
STreeNode.prototype.select = function(){
    this.checkBoxEle.setAttribute("checked", "checked");
    // $(this.checkBoxEle).prop('checked', true)
    this.isSelect = true;
    if(this.type === 'item') {
        this.onSelectChange(this)
    }
    this.childrenList.forEach(function(item){
        item.select();
    })
};
STreeNode.prototype.unSelect = function(){
    this.checkBoxEle.removeAttribute("checked")
    // $(this.checkBoxEle).prop('checked', false)

    this.isSelect = false;
    if(this.type === 'item') {
        this.onSelectChange(this)
    }
    this.childrenList.forEach(function(item){
        item.unSelect();
    })
};
STreeNode.prototype.setData = function(data, option) {
    var that = this
    if(data.childrens) {
        var node = new STreeGroupNode(data.name, data.id, option);
        this.addNode(node);
        data.childrens.forEach(function(data) {
            node.setData(data, option);
        })
    }else {
        var node = new STreeItemNode(data.name, data.id, option);
        this.addNode(node);
    }
}


/* 树的 group node 类 */
var STreeGroupNode = function(name, id, option) {
    STreeNode.call(this, name, id, 'group', option);

    this.element = document.createElement('li');
    this.element.className = "list-item-wrap group-item open";

    this.childElement = document.createElement('ul');
    this.childElement.className = "group-item-wrap";

    var itemEle = document.createElement('span');
    itemEle.className = "item";
    var iconEle = document.createElement('span');
    iconEle.className = "icon icon-group";
    var nameEle = document.createElement('span');
    nameEle.innerHTML = this.name;
    nameEle.className = "name"
    var labelEle = document.createElement('span');
    labelEle.className = "checkbox"
    this.checkBoxEle = document.createElement('input');
    this.checkBoxEle.setAttribute("type", "checkbox");
    labelEle.appendChild(this.checkBoxEle);
    labelEle.appendChild(document.createElement('i'))
    itemEle.appendChild(iconEle);
    itemEle.appendChild(nameEle);
    itemEle.appendChild(labelEle);
    this.element.appendChild(itemEle);
    this.element.appendChild(this.childElement);

    itemEle.onclick = function(event) {
        if(event.target.nodeName.toUpperCase() !== "I"){
            if(this.element.className.indexOf('open') === -1) {
                this.show();
            }else {
                this.hide();
            }
        }
    }.bind(this)

    labelEle.onclick = function(even) {
        if(event.target.nodeName.toUpperCase() === "I"){
            if(this.isSelect) {
                this.unSelect();
            }else {
                this.select();
            }
        }
    }.bind(this)
}
extend(STreeGroupNode, STreeNode);

/* 树的 item node 类 */
var STreeItemNode = function(name, id, option) {
    STreeNode.call(this, name, id, 'item', option);

    this.element = document.createElement('li');
    this.element.className = "list-item-wrap";

    var itemEle = document.createElement('span');
    itemEle.className = "item";
    var iconEle = document.createElement('span');
    iconEle.className = "icon";
    var nameEle = document.createElement('span');
    nameEle.innerHTML = this.name;
    nameEle.className = "name"
    var labelEle = document.createElement('span');
    labelEle.className = "checkbox"
    this.checkBoxEle = document.createElement('input');
    this.checkBoxEle.setAttribute("type", "checkbox");
    labelEle.appendChild(this.checkBoxEle);
    labelEle.appendChild(document.createElement('i'))
    // itemEle.appendChild(iconEle);
    itemEle.appendChild(nameEle);
    itemEle.appendChild(labelEle);
    this.element.appendChild(itemEle);

    itemEle.onclick = function(event) {
        if(this.isSelect) {
            this.unSelect();
        }else {
            this.select();
        }
    }.bind(this)
}
extend(STreeItemNode, STreeNode);

var STreeRoorNode = function(name, id, option) {
    STreeNode.call(this, name, id, 'root', option);

    this.element = document.createElement('li');
    this.element.className = "list-item-wrap root-item open";

    this.childElement = document.createElement('ul');
    this.childElement.className = "group-item-wrap";

    var itemEle = document.createElement('span');
    itemEle.className = "item";
    var iconEle = document.createElement('span');
    iconEle.className = "icon icon-all";
    var nameEle = document.createElement('span');
    nameEle.innerHTML = this.name;
    nameEle.className = "name"
    var labelEle = document.createElement('span');
    labelEle.className = "checkbox"
    this.checkBoxEle = document.createElement('input');
    this.checkBoxEle.setAttribute("type", "checkbox");
    labelEle.appendChild(this.checkBoxEle);
    labelEle.appendChild(document.createElement('i'))
    itemEle.appendChild(iconEle);
    itemEle.appendChild(nameEle);
    itemEle.appendChild(labelEle);
    this.element.appendChild(itemEle);
    this.element.appendChild(this.childElement);

    itemEle.onclick = function(event) {
        if(event.target.nodeName.toUpperCase() !== "I"){
            if(this.element.className.indexOf('open') === -1) {
                this.show();
            }else {
                this.hide();
            }
        }
    }.bind(this)

    labelEle.onclick = function(even) {
        if(event.target.nodeName.toUpperCase() === "I"){
            if(this.isSelect) {
                this.unSelect();
            }else {
                this.select();
            }
        }
    }.bind(this)
}
extend(STreeRoorNode, STreeGroupNode);

var tree = new STree(document.querySelector(".left-box"), data, {
    onSelectChange: function(item) {
        console.log(item.isSelect, item.name)
    },
    onShowChange: function(item) {
        console.log(item)
    }
})

</script>
<!-- 
<div class="tree-wrap">
    <ul class="group-item-wrap">
        <li class="list-item-wrap group-item">
            <span class="item">
                <span class="icon icon-all"></span><span class="name">选择全部</span>
                    <label class="checkbox">
                    <input type="checkbox">
                    <i></i>
                </label>
            </span>
            <ul class="group-item-wrap">
                <li class="list-item-wrap group-item">
                    <span class="item">
                        <span class="icon icon-group"></span><span class="name">体验测试</span>
                            <label class="checkbox">
                            <input type="checkbox">
                            <i></i>
                        </label>
                    </span>
                    <ul class="group-item-wrap">
                        <li class="list-item-wrap">
                            <span class="item">
                                <span class="icon"></span>
                                <span class="name">引用组1</span>
                                    <label class="checkbox">
                                    <input type="checkbox">
                                    <i></i>
                                </label>
                            </span>
                        </li>
                        <li class="list-item-wrap">
                            <span class="item">
                                <span class="icon"></span>
                                <span class="name">引用组2</span>
                                    <label class="checkbox">
                                    <input type="checkbox">
                                    <i></i>
                                </label>
                            </span>
                        </li>
                        <li class="list-item-wrap">
                            <span class="item">
                                <span class="icon"></span>
                                <span class="name">引用组3</span>
                                    <label class="checkbox">
                                    <input type="checkbox">
                                    <i></i>
                                </label>
                            </span>
                        </li>
                        <li class="list-item-wrap">
                            <span class="item">
                                <span class="icon"></span>
                                <span class="name">引用组4</span>
                                    <label class="checkbox">
                                    <input type="checkbox">
                                    <i></i>
                                </label>
                            </span>
                        </li>
                    </ul>
                </li>
                <li class="list-item-wrap  group-item">
                    <span class="item">
                        <span class="icon icon-group"></span><span class="name">无线运营</span>
                        <label class="checkbox">
                            <input type="checkbox">
                            <i></i>
                        </label>
                    </span>
                    <ul class="group-item-wrap">
                        <li class="list-item-wrap">
                            <span class="item">
                                <span class="icon"></span>
                                <span class="name">引用组1</span>
                                    <label class="checkbox">
                                    <input type="checkbox">
                                    <i></i>
                                </label>
                            </span>
                        </li>
                        <li class="list-item-wrap">
                            <span class="item">
                                <span class="icon"></span>
                                <span class="name">引用组2</span>
                                    <label class="checkbox">
                                    <input type="checkbox">
                                    <i></i>
                                </label>
                            </span>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
</div>
 -->
</html>